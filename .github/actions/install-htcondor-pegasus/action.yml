name: Install HTCondor and Pegasus
description: "Composite action to install HTCondor and Pegasus on Ubuntu runners."
runs:
  using: "composite"
  steps:
    - name: Install HTCondor
      run: |
        wget -qO - https://research.cs.wisc.edu/htcondor/ubuntu/HTCondor-Release.gpg.key | sudo apt-key add -
        echo "deb http://research.cs.wisc.edu/htcondor/ubuntu/8.9/focal focal contrib" | sudo tee -a /etc/apt/sources.list
        echo "deb-src http://research.cs.wisc.edu/htcondor/ubuntu/8.9/focal focal contrib" | sudo tee -a /etc/apt/sources.list
        sudo apt-get -o Acquire::Retries=3 update
        sudo apt-get -o Acquire::Retries=3 install -y minihtcondor
        # systemd may not be available in all runners, ignore failures when enabling
        sudo systemctl start condor || true
        sudo systemctl enable condor || true

    - name: Install Pegasus
      run: |
        wget -qO - https://download.pegasus.isi.edu/pegasus/gpg.txt | sudo apt-key add -
        echo "deb https://download.pegasus.isi.edu/pegasus/ubuntu noble main" | sudo tee -a /etc/apt/sources.list
        sudo apt-get -o Acquire::Retries=3 update
        sudo apt-get -o Acquire::Retries=3 install -y pegasus=5.1.1-1+ubuntu24
