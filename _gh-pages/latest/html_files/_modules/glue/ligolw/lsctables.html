<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>glue.ligolw.lsctables &mdash; PyCBC 0.0a8230 documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/terminal.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/typed.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> PyCBC
          </a>
              <div class="version">
                1.18.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credit.html">Use of PyCBC in Scientific Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docker.html">Running PyCBC under Docker</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../inference.html">PyCBC inference documentation (<code class="docutils literal notranslate"><span class="pre">pycbc.inference</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_make_psd_estimation_workflow.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_psd_estimation_workflow</span></code>: A workflow generator for noise estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_make_coinc_search_workflow.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_coinc_search_workflow</span></code>: A workflow to search for gravitational waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pygrb.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_offline_grb_workflow</span></code>: A GRB triggered CBC analysis workflow generator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tmpltbank.html">PyCBC template bank generation documentation (<code class="docutils literal notranslate"><span class="pre">pycbc.tmpltbank</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwinj.html">Hardware injection waveform generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../banksim.html">Calculating the Effectualness (Fitting Factor) of Template Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faithsim.html">Dag Generator for Doing Faithfulness Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upload_to_gracedb.html">Uploading triggers to gracedb</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform_plugin.html">Making new waveform approximants available to PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../catalog.html">Catalog of Observed Gravitational-wave Mergers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataquality.html">Query times of valid data, hardware injections, and more.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frame.html">Reading Gravitational-wave Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fft.html">Performing FFTs in PyCBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gw150914.html">Signal Processing with GW150914</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../detector.html">Gravitational-wave Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../psd.html">Handling PSDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../noise.html">Generating Noise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform.html">Waveforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filter.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributions.html">Using PyCBC Distributions from PyCBC Inference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../building_bundled_executables.html">Building Bundled Executables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">Documenting PyCBC code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Creating Releases of PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../formats/hdf_format.html">HDF files within the PyCBC workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow: the inspiral analysis workflow generator (<code class="docutils literal notranslate"><span class="pre">pycbc.workflow</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">pycbc</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyCBC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>glue.ligolw.lsctables</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for glue.ligolw.lsctables</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2006--2016  Kipp Cannon</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c1"># under the terms of the GNU General Public License as published by the</span>
<span class="c1"># Free Software Foundation; either version 3 of the License, or (at your</span>
<span class="c1"># option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c1"># Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                   Preamble</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LSC Table definitions.  These must be kept synchronized with the official</span>
<span class="sd">definitions in the LDAS CVS repository at</span>
<span class="sd">http://www.ldas-sw.ligo.caltech.edu/cgi-bin/cvsweb.cgi/ldas/dbms/db2/sql.</span>
<span class="sd">Maintenance of the table definitions is left to the conscience of</span>
<span class="sd">interested users.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">total_ordering</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">functools32</span> <span class="kn">import</span> <span class="n">total_ordering</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">xml</span> <span class="kn">import</span> <span class="n">sax</span>

<span class="kn">from</span> <span class="nn">ligo</span> <span class="kn">import</span> <span class="n">segments</span>

<span class="kn">from</span> <span class="nn">glue</span> <span class="kn">import</span> <span class="n">git_version</span>
<span class="kn">from</span> <span class="nn">glue</span> <span class="kn">import</span> <span class="n">iterutils</span>
<span class="kn">import</span> <span class="nn">lal</span>
<span class="kn">from</span> <span class="nn">lal</span> <span class="kn">import</span> <span class="n">LIGOTimeGPS</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ligolw</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">table</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">ligolwtypes</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ilwd</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Kipp Cannon &lt;kipp.cannon@ligo.org&gt;&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;git id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">git_version</span><span class="o">.</span><span class="n">id</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="n">git_version</span><span class="o">.</span><span class="n">date</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            Convenience Functions</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">New</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Construct a pre-defined LSC table.  The optional columns argument</span>
<span class="sd">	is a sequence of the names of the columns the table should be</span>
<span class="sd">	constructed with.  If columns = None, then the table is constructed</span>
<span class="sd">	with all valid columns (use columns = [] to create a table with no</span>
<span class="sd">	columns).</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; import sys</span>
<span class="sd">	&gt;&gt;&gt; tbl = New(ProcessTable, [u&quot;process_id&quot;, u&quot;start_time&quot;, u&quot;end_time&quot;, u&quot;comment&quot;])</span>
<span class="sd">	&gt;&gt;&gt; tbl.write(sys.stdout)	# doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">	&lt;Table Name=&quot;process:table&quot;&gt;</span>
<span class="sd">		&lt;Column Name=&quot;process:comment&quot; Type=&quot;lstring&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;process:end_time&quot; Type=&quot;int_4s&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;process:process_id&quot; Type=&quot;ilwd:char&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;process:start_time&quot; Type=&quot;int_4s&quot;/&gt;</span>
<span class="sd">		&lt;Stream Delimiter=&quot;,&quot; Name=&quot;process:table&quot; Type=&quot;Local&quot;&gt;</span>
<span class="sd">		&lt;/Stream&gt;</span>
<span class="sd">	&lt;/Table&gt;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TableName</span><span class="o">.</span><span class="n">enc</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tableName</span><span class="p">)}),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="n">colnamefmt</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="sa">u</span><span class="s2">&quot;:</span><span class="si">%s</span><span class="s2">&quot;</span>
	<span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">ligolw</span><span class="o">.</span><span class="n">ElementError</span><span class="p">(</span><span class="s2">&quot;invalid Column &#39;</span><span class="si">%s</span><span class="s2">&#39; for Table &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span>
			<span class="n">new</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">colnamefmt</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">new</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">[</span><span class="n">key</span><span class="p">]})))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="n">new</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">colnamefmt</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})))</span>
	<span class="n">new</span><span class="o">.</span><span class="n">_end_of_columns</span><span class="p">()</span>
	<span class="n">new</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">new</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;Delimiter&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="o">.</span><span class="n">Delimiter</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">default</span><span class="p">})))</span>
	<span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">HasNonLSCTables</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return True if the document tree below elem contains non-LSC</span>
<span class="sd">	tables, otherwise return False.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TableByName</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="n">ligolw</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">tagName</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">instrumentsproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">ifos</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Parse the values stored in the &quot;ifos&quot; and &quot;instruments&quot;</span>
<span class="sd">		columns found in many tables.  This function is mostly for</span>
<span class="sd">		internal use by the .instruments properties of the</span>
<span class="sd">		corresponding row classes.  The mapping from input to</span>
<span class="sd">		output is as follows (rules are applied in order):</span>

<span class="sd">		input is None --&gt; output is None</span>

<span class="sd">		input contains &quot;,&quot; --&gt; output is set of strings split on</span>
<span class="sd">		&quot;,&quot; with leading and trailing whitespace stripped from each</span>
<span class="sd">		piece and empty strings removed from the set</span>

<span class="sd">		input contains &quot;+&quot; --&gt; output is set of strings split on</span>
<span class="sd">		&quot;+&quot; with leading and trailing whitespace stripped from each</span>
<span class="sd">		piece and empty strings removed from the set</span>

<span class="sd">		else, after stripping input of leading and trailing</span>
<span class="sd">		whitespace,</span>

<span class="sd">		input has an even length greater than two --&gt; output is set</span>
<span class="sd">		of two-character pieces</span>

<span class="sd">		input is a non-empty string --&gt; output is a set containing</span>
<span class="sd">		input as single value</span>

<span class="sd">		else output is an empty set.</span>

<span class="sd">		NOTE:  the complexity of this algorithm is a consequence of</span>
<span class="sd">		there being several conventions in use for encoding a set</span>
<span class="sd">		of instruments into one of these columns;  it has been</span>
<span class="sd">		proposed that L.L.W.  documents standardize on the</span>
<span class="sd">		comma-delimited variant of the encodings recognized by this</span>
<span class="sd">		function, and for this reason the inverse function,</span>
<span class="sd">		instrumentsproperty.set(), implements that encoding only.</span>

<span class="sd">		NOTE:  to force a string containing an even number of</span>
<span class="sd">		characters to be interpreted as a single instrument name</span>
<span class="sd">		and not to be be split into two-character pieces, add a &quot;,&quot;</span>
<span class="sd">		character to the end to force the comma-delimited decoding</span>
<span class="sd">		to be used.  instrumentsproperty.set() does this for you.</span>

<span class="sd">		Example:</span>

<span class="sd">		&gt;&gt;&gt; print(instrumentsproperty.get(None))</span>
<span class="sd">		None</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;&quot;) == set()</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;  ,  ,,&quot;) == set()</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1&quot;) == {&#39;H1&#39;}</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;SWIFT&quot;) == {&#39;SWIFT&#39;}</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1L1&quot;) == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1L1,&quot;) == {&#39;H1L1&#39;}</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1,L1&quot;) == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1+L1&quot;) == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">ifos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="sa">u</span><span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
			<span class="n">result</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">result</span>
		<span class="k">if</span> <span class="sa">u</span><span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;+&quot;</span><span class="p">))</span>
			<span class="n">result</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">result</span>
		<span class="n">ifos</span> <span class="o">=</span> <span class="n">ifos</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
			<span class="c1"># if ifos is a string with an even number of</span>
			<span class="c1"># characters greater than two, split it into</span>
			<span class="c1"># two-character pieces.  FIXME:  remove this when</span>
			<span class="c1"># the inspiral codes don&#39;t write ifos strings like</span>
			<span class="c1"># this anymore</span>
			<span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifos</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">ifos</span><span class="p">])</span>
		<span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Convert an iterable of instrument names into a value</span>
<span class="sd">		suitable for storage in the &quot;ifos&quot; column found in many</span>
<span class="sd">		tables.  This function is mostly for internal use by the</span>
<span class="sd">		.instruments properties of the corresponding row classes.</span>
<span class="sd">		The input can be None or an iterable of zero or more</span>
<span class="sd">		instrument names, none of which may be zero-length, consist</span>
<span class="sd">		exclusively of spaces, or contain &quot;,&quot; or &quot;+&quot; characters.</span>
<span class="sd">		The output is a single string containing the unique</span>
<span class="sd">		instrument names concatenated using &quot;,&quot; as a delimiter.</span>
<span class="sd">		instruments will only be iterated over once and so can be a</span>
<span class="sd">		generator expression.  Whitespace is allowed in instrument</span>
<span class="sd">		names but might not be preserved.  Repeated names will not</span>
<span class="sd">		be preserved.</span>

<span class="sd">		NOTE:  in the special case that there is 1 instrument name</span>
<span class="sd">		in the iterable and it has an even number of characters &gt; 2</span>
<span class="sd">		in it, the output will have a &quot;,&quot; appended in order to</span>
<span class="sd">		force instrumentsproperty.get() to parse the string back</span>
<span class="sd">		into a single instrument name.  This is a special case</span>
<span class="sd">		included temporarily to disambiguate the encoding until all</span>
<span class="sd">		codes have been ported to the comma-delimited encoding.</span>
<span class="sd">		This behaviour will be discontinued at that time.  DO NOT</span>
<span class="sd">		WRITE CODE THAT RELIES ON THIS!  You have been warned.</span>

<span class="sd">		Example:</span>

<span class="sd">		&gt;&gt;&gt; print(instrumentsproperty.set(None))</span>
<span class="sd">		None</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set(()) == &#39;&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,)) == &#39;H1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,u&quot;H1&quot;,u&quot;H1&quot;)) == &#39;H1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,u&quot;L1&quot;)) == &#39;H1,L1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;SWIFT&quot;,)) == &#39;SWIFT&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1L1&quot;,)) == &#39;H1L1,&#39;</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="n">_instruments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">))</span>
		<span class="c1"># safety check:  refuse to accept blank names, or names</span>
		<span class="c1"># with commas or pluses in them as they cannot survive the</span>
		<span class="c1"># encode/decode process</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">instrument</span> <span class="ow">or</span> <span class="sa">u</span><span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">instrument</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">_instruments</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
			<span class="c1"># special case disambiguation.  FIXME:  remove when</span>
			<span class="c1"># everything uses the comma-delimited encoding</span>
			<span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">instruments</span><span class="p">))</span>


<span class="n">instrument_set_from_ifos</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="o">.</span><span class="n">get</span>
<span class="n">ifos_from_instrument_set</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="o">.</span><span class="n">set</span>


<span class="k">class</span> <span class="nc">gpsproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Descriptor used internally to implement LIGOTimeGPS-valued</span>
<span class="sd">	properties.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">s_name</span> <span class="o">=</span> <span class="n">s_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">get_s</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">s_name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ns_name</span> <span class="o">=</span> <span class="n">ns_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">ns_name</span><span class="p">)</span>

	<span class="n">posinf</span> <span class="o">=</span> <span class="mh">0x7FFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span>
	<span class="n">neginf</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span>
	<span class="n">infs</span> <span class="o">=</span> <span class="n">posinf</span><span class="p">,</span> <span class="n">neginf</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
		<span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">ns</span> <span class="o">==</span> <span class="mh">0xFFFFFFFF</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">PosInfinity</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">posinf</span> <span class="k">else</span> <span class="n">segments</span><span class="o">.</span><span class="n">NegInfinity</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">gps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gps</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">infinity</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">gps</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">gps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">s</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">posinf</span>
			<span class="k">elif</span> <span class="n">gps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">s</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neginf</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">s</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">gpsSeconds</span>
				<span class="n">ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">gpsNanoSeconds</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># try converting and going again</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="n">gps</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">999999999</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;denormalized LIGOTimeGPS not allowed&quot;</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_name</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_name</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gpsproperty_with_gmst</span><span class="p">(</span><span class="n">gpsproperty</span><span class="p">):</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">,</span> <span class="n">gmst_name</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">gpsproperty_with_gmst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span> <span class="o">=</span> <span class="n">gmst_name</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">gpsproperty_with_gmst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">gps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># re-retrieve the value in case it required type</span>
			<span class="c1"># conversion</span>
			<span class="n">gps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="n">lal</span><span class="o">.</span><span class="n">GreenwichMeanSiderealTime</span><span class="p">(</span><span class="n">gps</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">segmentproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Descriptor used internally to expose pairs of GPS-valued properties</span>
<span class="sd">	as segment-valued properties.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_name</span><span class="p">,</span> <span class="n">stop_name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop_name</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
		<span class="n">stop</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">seg</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                process:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">ProcessID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;process_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProcessTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;process&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cvs_repository&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cvs_entry_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;is_online&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;unix_procid&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;jobid&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (process_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">ProcessID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ids_by_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set containing the process IDs from rows whose</span>
<span class="sd">		program string equals the given program.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">program</span> <span class="o">==</span> <span class="n">program</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Process</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Process()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifos == &#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ProcessTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set of the instruments for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Serialize a sequence of instruments into the ifos</span>
<span class="sd">		attribute.  The instrument names must not contain the &quot;,&quot;</span>
<span class="sd">		character.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">instruments</span>


<span class="n">ProcessTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Process</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                lfn:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">LfnID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;lfn&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;lfn_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LfnTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;lfn&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lfn_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (lfn_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">LfnID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Lfn</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LfnTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">LfnTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Lfn</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             process_params:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">ProcessParamsTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;process_params&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="c1"># FIXME: these constraints break ID remapping in the DB backend.</span>
	<span class="c1"># an index is used instead.  switch back to the constraints when I</span>
	<span class="c1"># can figure out how not to break remapping.</span>
	<span class="c1">#constraints = &quot;PRIMARY KEY (process_id, param)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;pp_pip_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">),</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">Types</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">ligolw</span><span class="o">.</span><span class="n">ElementError</span><span class="p">(</span><span class="s2">&quot;unrecognized type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">row</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
		<span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProcessParams</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = ProcessParams()</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = u&quot;test&quot;</span>
<span class="sd">	&gt;&gt;&gt; assert x.type == &#39;lstring&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.value == &#39;test&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.pyvalue == &#39;test&#39;</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = 6.</span>
<span class="sd">	&gt;&gt;&gt; assert x.type == &#39;real_8&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.value == &#39;6&#39;</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue</span>
<span class="sd">	6.0</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.type)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.value)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.pyvalue)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = True</span>
<span class="sd">	&gt;&gt;&gt; assert(x.type) == &#39;int_4s&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.value == &#39;1&#39;</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue</span>
<span class="sd">	1</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">pyvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">parsefunc</span> <span class="o">=</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">ToPyType</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">parsefunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

	<span class="nd">@pyvalue</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">pyvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">FromPyType</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type not supported: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">StringTypes</span> <span class="k">else</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">FormatFunc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>


<span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">ProcessParams</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             search_summary:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">SearchSummaryTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;search_summary&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;shared_object&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lalwrapper_cvs_tag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lal_cvs_tag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nevents&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nnodes&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ss_pi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,),</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_inlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlist object describing the times spanned by</span>
<span class="sd">		the input segments of all rows in the table.</span>

<span class="sd">		Note:  the result is not coalesced, the segmentlist</span>
<span class="sd">		contains the segments as they appear in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">in_segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_outlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlist object describing the times spanned by</span>
<span class="sd">		the output segments of all rows in the table.</span>

<span class="sd">		Note:  the result is not coalesced, the segmentlist</span>
<span class="sd">		contains the segments as they appear in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">out_segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_in_segmentlistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlistdict mapping instrument to in segment</span>
<span class="sd">		list.  If process_ids is a sequence of process IDs, then</span>
<span class="sd">		only rows with matching IDs are included otherwise all rows</span>
<span class="sd">		are included.</span>

<span class="sd">		Note:  the result is not coalesced, each segmentlist</span>
<span class="sd">		contains the segments listed for that instrument as they</span>
<span class="sd">		appeared in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">seglists</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlistdict</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">ifos</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">instruments</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
			<span class="k">if</span> <span class="n">process_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="ow">in</span> <span class="n">process_ids</span><span class="p">:</span>
				<span class="n">seglists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">in_segment</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">seglists</span>

	<span class="k">def</span> <span class="nf">get_out_segmentlistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlistdict mapping instrument to out segment</span>
<span class="sd">		list.  If process_ids is a sequence of process IDs, then</span>
<span class="sd">		only rows with matching IDs are included otherwise all rows</span>
<span class="sd">		are included.</span>

<span class="sd">		Note:  the result is not coalesced, each segmentlist</span>
<span class="sd">		contains the segments listed for that instrument as they</span>
<span class="sd">		appeared in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">seglists</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlistdict</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">ifos</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">instruments</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
			<span class="k">if</span> <span class="n">process_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="ow">in</span> <span class="n">process_ids</span><span class="p">:</span>
				<span class="n">seglists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">out_segment</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">seglists</span>


<span class="k">class</span> <span class="nc">SearchSummary</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SearchSummary()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifos == &#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">	&gt;&gt;&gt; x.in_start = x.out_start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.in_end = x.out_end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.in_segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.out_segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.in_segment = x.out_segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.in_segment)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.out_segment)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">in_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;in_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;in_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">in_end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;in_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;in_end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">out_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;out_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;out_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">out_end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;out_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;out_end_time_ns&quot;</span><span class="p">)</span>

	<span class="n">in_segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;in_start&quot;</span><span class="p">,</span> <span class="s2">&quot;in_end&quot;</span><span class="p">)</span>
	<span class="n">out_segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;out_start&quot;</span><span class="p">,</span> <span class="s2">&quot;out_end&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set of the instruments for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Serialize a sequence of instruments into the ifos</span>
<span class="sd">		attribute.  The instrument names must not contain the &quot;,&quot;</span>
<span class="sd">		character.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">get_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the input segment.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_segment</span>

	<span class="k">def</span> <span class="nf">set_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the input segment.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">in_segment</span> <span class="o">=</span> <span class="n">seg</span>

	<span class="k">def</span> <span class="nf">get_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the output segment.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_segment</span>

	<span class="k">def</span> <span class="nf">set_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the output segment.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">out_segment</span> <span class="o">=</span> <span class="n">seg</span>


<span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SearchSummary</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            search_summvars:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SearchSummVarsID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;search_summvars&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;search_summvar_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SearchSummVarsTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;search_summvars&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search_summvar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (search_summvar_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SearchSummVarsID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SearchSummVars</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SearchSummVars</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            experiment:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">ExpDefID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;experiment&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;experiment_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExperimentTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;experiment&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;experiment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search_group&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lars_id&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instruments&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;gps_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;gps_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (experiment_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">ExpDefID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_expr_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_group</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">lars_id</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">gps_start_time</span><span class="p">,</span> <span class="n">gps_end_time</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the expr_def_id for the row in the table whose</span>
<span class="sd">		values match the givens.</span>
<span class="sd">		If a matching row is not found, returns None.</span>

<span class="sd">		@search_group: string representing the search group (e.g., cbc)</span>
<span class="sd">		@serach: string representing search (e.g., inspiral)</span>
<span class="sd">		@lars_id: string representing lars_id</span>
<span class="sd">		@instruments: the instruments; must be a python set</span>
<span class="sd">		@gps_start_time: string or int representing the gps_start_time of the experiment</span>
<span class="sd">		@gps_end_time: string or int representing the gps_end_time of the experiment</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># create string from instrument set</span>
		<span class="n">instruments</span> <span class="o">=</span> <span class="n">ifos_from_instrument_set</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>

		<span class="c1"># look for the ID</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">search_group</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lars_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">gps_start_time</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">gps_end_time</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">search_group</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">lars_id</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">gps_start_time</span><span class="p">,</span> <span class="n">gps_end_time</span><span class="p">,</span> <span class="n">comments</span><span class="p">):</span>
				<span class="c1"># found it</span>
				<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span>

		<span class="c1"># experiment not found in table</span>
		<span class="k">return</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">write_new_expr_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_group</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">lars_id</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">gps_start_time</span><span class="p">,</span> <span class="n">gps_end_time</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Creates a new def_id for the given arguments and returns it. </span>
<span class="sd">		If an entry already exists with these, will just return that id.</span>

<span class="sd">		@search_group: string representing the search group (e.g., cbc)</span>
<span class="sd">		@serach: string representing search (e.g., inspiral)</span>
<span class="sd">		@lars_id: string representing lars_id</span>
<span class="sd">		@instruments: the instruments; must be a python set</span>
<span class="sd">		@gps_start_time: string or int representing the gps_start_time of the experiment</span>
<span class="sd">		@gps_end_time: string or int representing the gps_end_time of the experiment</span>
<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="c1"># check if id already exists</span>
		<span class="n">check_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expr_id</span><span class="p">(</span> <span class="n">search_group</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">lars_id</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">gps_start_time</span><span class="p">,</span> <span class="n">gps_end_time</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">comments</span> <span class="p">)</span>
		<span class="k">if</span> <span class="n">check_id</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">check_id</span>

		<span class="c1"># experiment not found in table</span>
		<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">search_group</span> <span class="o">=</span> <span class="n">search_group</span>
		<span class="n">row</span><span class="o">.</span><span class="n">search</span> <span class="o">=</span> <span class="n">search</span>
		<span class="n">row</span><span class="o">.</span><span class="n">lars_id</span> <span class="o">=</span> <span class="n">lars_id</span>
		<span class="n">row</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">ifos_from_instrument_set</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
		<span class="n">row</span><span class="o">.</span><span class="n">gps_start_time</span> <span class="o">=</span> <span class="n">gps_start_time</span>
		<span class="n">row</span><span class="o">.</span><span class="n">gps_end_time</span> <span class="o">=</span> <span class="n">gps_end_time</span>
		<span class="n">row</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="n">comments</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

		<span class="c1"># return new ID</span>
		<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span>

	<span class="k">def</span> <span class="nf">get_row_from_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns row in matching the given experiment_id.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">==</span> <span class="n">experiment_id</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;duplicate ids in experiment table&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;id &#39;</span><span class="si">%s</span><span class="s2">&#39; not found in table&quot;</span> <span class="o">%</span> <span class="n">experiment_id</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExperimentTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_instruments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set of the instruments for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_instruments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Serialize a sequence of instruments into the ifos</span>
<span class="sd">		attribute.  The instrument names must not contain the &quot;,&quot;</span>
<span class="sd">		character.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">ifos_from_instrument_set</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>


<span class="n">ExperimentTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Experiment</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            experiment_summary:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">ExpSummID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;experiment_summary&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;experiment_summ_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExperimentSummaryTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;experiment_summary&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;experiment_summ_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;experiment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;veto_def_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;datatype&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sim_proc_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nevents&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4u&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (experiment_summ_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;es_ei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;experiment_id&quot;</span><span class="p">,),</span>
		<span class="s2">&quot;es_dt_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;datatype&quot;</span><span class="p">,)</span>
	<span class="p">}</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">ExpSummID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="n">datatypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;slide&#39;</span><span class="p">,</span> <span class="s1">&#39;all_data&#39;</span><span class="p">,</span> <span class="s1">&#39;playground&#39;</span><span class="p">,</span> <span class="s1">&#39;exclude_play&#39;</span><span class="p">,</span> <span class="s1">&#39;simulation&#39;</span><span class="p">]</span>
		

	<span class="k">def</span> <span class="nf">as_id_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return table as a dictionary mapping experiment_id, time_slide_id,</span>
<span class="sd">		veto_def_name, and sim_proc_id (if it exists) to the expr_summ_id.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">veto_def_name</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">sim_proc_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">]:</span>
				<span class="c1"># entry already exists, raise error</span>
				<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;duplicate entries in experiment_summary table&quot;</span><span class="p">)</span>
			<span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">][(</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">veto_def_name</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">sim_proc_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span>

		<span class="k">return</span> <span class="n">d</span>

	<span class="k">def</span> <span class="nf">get_expr_summ_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the expr_summ_id for the row in the table whose experiment_id, </span>
<span class="sd">		time_slide_id, veto_def_name, and datatype match the given. If sim_proc_id,</span>
<span class="sd">		will retrieve the injection run matching that sim_proc_id.</span>
<span class="sd">		If a matching row is not found, returns None.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1"># look for the ID</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">veto_def_name</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">sim_proc_id</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">sim_proc_id</span><span class="p">):</span>
				<span class="c1"># found it</span>
				<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span>

		<span class="c1"># if get to here, experiment not found in table</span>
		<span class="k">return</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">write_experiment_summ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Writes a single entry to the experiment_summ table. This can be used</span>
<span class="sd">		for either injections or non-injection experiments. However, it is</span>
<span class="sd">		recommended that this only be used for injection experiments; for</span>
<span class="sd">		non-injection experiments write_experiment_summ_set should be used to</span>
<span class="sd">		ensure that an entry gets written for every time-slide performed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># check if entry alredy exists; if so, return value</span>
		<span class="n">check_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expr_summ_id</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="n">sim_proc_id</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">check_id</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">check_id</span>

		<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">=</span> <span class="n">experiment_id</span>
		<span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span> <span class="o">=</span> <span class="n">time_slide_id</span>
		<span class="n">row</span><span class="o">.</span><span class="n">veto_def_name</span> <span class="o">=</span> <span class="n">veto_def_name</span>
		<span class="n">row</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">datatype</span>
		<span class="n">row</span><span class="o">.</span><span class="n">sim_proc_id</span> <span class="o">=</span> <span class="n">sim_proc_id</span>
		<span class="n">row</span><span class="o">.</span><span class="n">nevents</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">row</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span>

	<span class="k">def</span> <span class="nf">write_non_injection_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">time_slide_dict</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="n">write_all_data</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_playground</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_exclude_play</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_dict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Method for writing a new set of non-injection experiments to the experiment</span>
<span class="sd">		summary table. This ensures that for every entry in the </span>
<span class="sd">		experiment table, an entry for every slide is added to</span>
<span class="sd">		the experiment_summ table, rather than just an entry for slides that</span>
<span class="sd">		have events in them. Default is to write a 3 rows for zero-lag: one for</span>
<span class="sd">		all_data, playground, and exclude_play. (If all of these are set to false,</span>
<span class="sd">		will only slide rows.)</span>
<span class="sd">		</span>
<span class="sd">		Note: sim_proc_id is hard-coded to None because time-slides</span>
<span class="sd">		are not performed with injections.</span>

<span class="sd">		@experiment_id: the experiment_id for this experiment_summary set</span>
<span class="sd">		@time_slide_dict: the time_slide table as a dictionary; used to figure out</span>
<span class="sd">			what is zero-lag and what is slide</span>
<span class="sd">		@veto_def_name: the name of the vetoes applied</span>
<span class="sd">		@write_all_data: if set to True, writes a zero-lag row who&#39;s datatype column</span>
<span class="sd">			is set to &#39;all_data&#39;</span>
<span class="sd">		@write_playground: same, but datatype is &#39;playground&#39;</span>
<span class="sd">		@write_exclude_play: same, but datatype is &#39;exclude_play&#39;</span>
<span class="sd">		@return_dict: if set to true, returns an id_dict of the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">slide_id</span> <span class="ow">in</span> <span class="n">time_slide_dict</span><span class="p">:</span>
			<span class="c1"># check if it&#39;s zero_lag or not</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span> <span class="n">time_slide_dict</span><span class="p">[</span><span class="n">slide_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">):</span>
				<span class="k">if</span> <span class="n">write_all_data</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">write_experiment_summ</span><span class="p">(</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="s1">&#39;all_data&#39;</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span>
				<span class="k">if</span> <span class="n">write_playground</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">write_experiment_summ</span><span class="p">(</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="s1">&#39;playground&#39;</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span>
				<span class="k">if</span> <span class="n">write_exclude_play</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">write_experiment_summ</span><span class="p">(</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="s1">&#39;exclude_play&#39;</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">write_experiment_summ</span><span class="p">(</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">slide_id</span><span class="p">,</span> <span class="n">veto_def_name</span><span class="p">,</span> <span class="s1">&#39;slide&#39;</span><span class="p">,</span> <span class="n">sim_proc_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span>

		<span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_id_dict</span><span class="p">()</span>


	<span class="k">def</span> <span class="nf">add_nevents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_summ_id</span><span class="p">,</span> <span class="n">num_events</span><span class="p">,</span> <span class="n">add_to_current</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Add num_events to the nevents column in a specific entry in the table. If</span>
<span class="sd">		add_to_current is set to False, will overwrite the current nevents entry in</span>
<span class="sd">		the row with num_events. Otherwise, default is to add num_events to</span>
<span class="sd">		the current value.</span>

<span class="sd">		Note: Can subtract events by passing a negative number to num_events.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span> <span class="o">!=</span> <span class="n">experiment_summ_id</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">nevents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">row</span><span class="o">.</span><span class="n">nevents</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">if</span> <span class="n">add_to_current</span><span class="p">:</span>
				<span class="n">row</span><span class="o">.</span><span class="n">nevents</span> <span class="o">+=</span> <span class="n">num_events</span>
				<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">nevents</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">row</span><span class="o">.</span><span class="n">nevents</span> <span class="o">=</span> <span class="n">num_events</span>
				<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">nevents</span>
				
		<span class="c1"># if get to here, couldn&#39;t find experiment_summ_id in the table</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; could not be found in the table&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">experiment_summ_id</span><span class="p">)))</span>


<span class="k">class</span> <span class="nc">ExperimentSummary</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExperimentSummaryTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">ExperimentSummaryTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">ExperimentSummary</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            experiment_map:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">ExperimentMapTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;experiment_map&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;experiment_summ_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;em_esi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;experiment_summ_id&quot;</span><span class="p">,),</span>
		<span class="s2">&quot;em_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_experiment_summ_ids</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">coinc_event_id</span> <span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Gets all the experiment_summ_ids that map to a given coinc_event_id.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">experiment_summ_ids</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">coinc_event_id</span> <span class="o">==</span> <span class="n">coinc_event_id</span><span class="p">:</span>
				<span class="n">experiment_summ_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">experiment_summ_id</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment_summ_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; could not be found in the experiment_map table&quot;</span> <span class="o">%</span> <span class="n">coinc_event_id</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">experiment_summ_ids</span>


<span class="k">class</span> <span class="nc">ExperimentMap</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExperimentMapTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">ExperimentMapTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">ExperimentMap</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               gds_trigger:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">GDSTriggerID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;gds_trigger&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GDSTriggerTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;gds_trigger&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char_u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;disposition&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;significance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_peak&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_average&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_sigma&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;freq_peak&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;freq_average&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;freq_sigma&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;noise_power&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;signal_power&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;pixel_count&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;binarydata&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char_u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;binarydata_length&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">GDSTriggerID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifo&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GDSTrigger</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">GDSTriggerTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="c1">#</span>
	<span class="c1"># Tile properties</span>
	<span class="c1">#</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>

	<span class="k">def</span> <span class="nf">get_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>

	<span class="k">def</span> <span class="nf">get_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_peak</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_peak</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time_peak</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>

	<span class="k">def</span> <span class="nf">get_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nanoseconds</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">period</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">low</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

<span class="n">GDSTriggerTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">GDSTrigger</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               sngl_burst:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglBurstID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sngl_burst&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglBurstTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_burst&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;stop_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;stop_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;fhigh&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;central_freq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tfvolume&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_lag&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_strain&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_frequency_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_strain_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_stop_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_stop_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_flow&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_fhigh&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_one_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_one_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_two_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_two_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_three_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_three_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglBurstID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifo&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: an array of column values for each row in the table</span>

<span class="sd">		@param column:</span>
<span class="sd">			name of column to return</span>
<span class="sd">		@returntype:</span>
<span class="sd">			numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_q</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">get_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the peak time of each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_peak</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the start time of each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_ms_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the start time of the most significant tile for</span>
<span class="sd">		each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_ms_start</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the stop time of each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_stop</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_ms_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the stop time of the most significant tile for</span>
<span class="sd">		each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_ms_stop</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the Q of each row in the table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_q</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the Z (Omega-Pipeline energy) of each row in the</span>
<span class="sd">		table</span>
<span class="sd">		@returntype: numpy.ndarray</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_z</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the period segment of each row in the table</span>
<span class="sd">		@returntype: ligo.segments.segmentlist</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_period</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the period segment for the most significant tile</span>
<span class="sd">		of each row in the table</span>
<span class="sd">		@returntype: ligo.segments.segmentlist</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_ms_period</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the frequency band of each row in the table</span>
<span class="sd">		@returntype: ligo.segments.segmentlist</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_band</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">get_ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: the frequency band of the most significant tile</span>
<span class="sd">		for each row in the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_ms_band</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">veto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: those rows of the table that don&#39;t lie within a</span>
<span class="sd">		given seglist</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_peak</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">vetoed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns: those rows of the table that lie within a given</span>
<span class="sd">		seglist</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_peak</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>

	<span class="k">def</span> <span class="nf">veto_seglistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglistdict</span><span class="p">):</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_peak</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seglistdict</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">vetoed_seglistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglistdict</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_peak</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglistdict</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>


<span class="k">class</span> <span class="nc">SnglBurst</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="c1">#</span>
	<span class="c1"># Tile properties</span>
	<span class="c1">#</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">stop</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;stop_time&quot;</span><span class="p">,</span> <span class="s2">&quot;stop_time_ns&quot;</span><span class="p">)</span>
	<span class="n">peak</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;peak_time&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="c1"># special case:  use duration if stop is not recorded</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="nd">@period</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

	<span class="nd">@band</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fhigh</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># not in LAL C version</span>
				<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fhigh</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># not in LAL C version</span>
				<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># &quot;Most significant pixel&quot; properties</span>
	<span class="c1">#</span>

	<span class="n">ms_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">ms_stop</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_stop_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_stop_time_ns&quot;</span><span class="p">)</span>
	<span class="n">ms_peak</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_peak_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_peak_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span>
		<span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span>
		<span class="c1"># special case:  use duration if stop is not recorded</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">-</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="nd">@ms_period</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span><span class="p">)</span>

	<span class="nd">@ms_band</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_fhigh</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_fhigh</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>

	<span class="c1"># legacy compatibility.  DO NOT USE</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>

	<span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>

	<span class="k">def</span> <span class="nf">set_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak</span>

	<span class="k">def</span> <span class="nf">set_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">peak</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span>

	<span class="k">def</span> <span class="nf">set_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>

	<span class="k">def</span> <span class="nf">get_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">band</span>

	<span class="k">def</span> <span class="nf">set_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="o">=</span> <span class="n">band</span>

	<span class="k">def</span> <span class="nf">get_ms_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span>

	<span class="k">def</span> <span class="nf">set_ms_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_ms_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span>

	<span class="k">def</span> <span class="nf">set_ms_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_period</span>

	<span class="k">def</span> <span class="nf">set_ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ms_period</span> <span class="o">=</span> <span class="n">period</span>

	<span class="k">def</span> <span class="nf">get_ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_band</span>

	<span class="k">def</span> <span class="nf">set_ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ms_band</span> <span class="o">=</span> <span class="n">band</span>

	<span class="c1">#</span>
	<span class="c1"># Omega-Pipeline properties</span>
	<span class="c1">#</span>

	<span class="k">def</span> <span class="nf">get_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span>

	<span class="k">def</span> <span class="nf">get_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.</span>


<span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglBurst</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              multi_burst:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># FIXME:  I think extra columns have been added here that aren&#39;t in other</span>
<span class="c1"># places where this table is defined.</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">MultiBurstTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;multi_burst&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;central_freq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;false_alarm_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_axis_ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_axis_dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_angle&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_angle_sig&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="c1"># FIXME:  like some other tables here, this table should have the</span>
	<span class="c1"># constraint that the coinc_event_id column is a primary key.  this</span>
	<span class="c1"># breaks ID reassignment in ligolw_sqlite, so until that is fixed</span>
	<span class="c1"># the constraint is being replaced with an index.</span>
	<span class="c1">#constraints = &quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;mb_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">MultiBurst</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">MultiBurstTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">peak</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;peak_time&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>

	<span class="nd">@period</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

	<span class="nd">@band</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>

	<span class="c1"># legacy compatibility.  DO NOT USE</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">get_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak</span>

	<span class="k">def</span> <span class="nf">set_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">peak</span> <span class="o">=</span> <span class="n">gps</span>


<span class="n">MultiBurstTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">MultiBurst</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             sngl_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglInspiralID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sngl_inspiral&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;template_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coa_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mtotal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ttotal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_final&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;rsqveto_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma7&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma8&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma9&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="c1"># FIXME:  lal uses an ID of 0 to indicate &quot;no valid ID has been</span>
	<span class="c1"># set&quot;, so we start at 1 for safety, but eventually that should be</span>
	<span class="c1"># fixed in LAL and then this can be put back to 0 for cleanliness.</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglInspiralID</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifo&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mf">250.</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mf">6.</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_bank_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_bank_chisq</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_cont_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;snr_over_chi&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_snr_over_chi</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;effective_snr&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_effective_snr</span><span class="p">(</span><span class="n">fac</span><span class="o">=</span><span class="n">fac</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;new_snr&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_snr</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;lvS5stat&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lvS5stat</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;chirp_eff_distance&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chirp_eff_dist</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">get_reduced_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq_dof&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;bank_chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;bank_chisq_dof&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;cont_chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;cont_chisq_dof&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_chisq&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="o">/</span> <span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_bank_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_bank_chisq&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="o">/</span> <span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_cont_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_cont_chisq&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="o">/</span> <span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="c1"># kwarg &#39;index&#39; is assigned to the parameter chisq_index</span>
		<span class="c1"># nhigh gives the asymptotic large  rho behaviour of d (ln chisq) / d (ln rho) </span>
		<span class="c1"># for fixed new_snr eg nhigh = 2 -&gt; chisq ~ rho^2 at large rho </span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_chisq&#39;</span><span class="p">)</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="n">newsnr</span> <span class="o">=</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">newsnr</span><span class="p">,</span> <span class="n">rchisq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">newsnr</span>

	<span class="k">def</span> <span class="nf">get_bank_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_bank_chisq&#39;</span><span class="p">)</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="n">banknewsnr</span> <span class="o">=</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">banknewsnr</span><span class="p">,</span> <span class="n">rchisq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">banknewsnr</span>

	<span class="k">def</span> <span class="nf">get_cont_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_cont_chisq&#39;</span><span class="p">)</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="n">contnewsnr</span> <span class="o">=</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">contnewsnr</span><span class="p">,</span> <span class="n">rchisq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">contnewsnr</span>

	<span class="k">def</span> <span class="nf">get_chirp_eff_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_mass</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
		<span class="n">mchirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;mchirp&#39;</span><span class="p">)</span>
		<span class="n">eff_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;eff_distance&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">SnglInspiral</span><span class="o">.</span><span class="n">chirp_distance</span><span class="p">(</span><span class="n">eff_dist</span><span class="p">,</span> <span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_snr_over_chi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_lvS5stat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">ifocut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a SnglInspiralTable with rows from self having IFO equal</span>
<span class="sd">		to the given ifo. If inplace, modify self directly, else create</span>
<span class="sd">		a new table and fill it.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
			<span class="n">iterutils</span><span class="o">.</span><span class="n">inplace_filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">ifo</span> <span class="o">==</span> <span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ifoTrigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">ifoTrigs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">ifo</span> <span class="o">==</span> <span class="n">ifo</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">ifoTrigs</span>

	<span class="k">def</span> <span class="nf">veto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seglist</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>
	
	<span class="k">def</span> <span class="nf">vetoed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the inverse of what veto returns, i.e., return the triggers</span>
<span class="sd">		that lie within a given seglist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>
	
	<span class="k">def</span> <span class="nf">veto_seglistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglistdict</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglistdict</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>
	
	<span class="k">def</span> <span class="nf">vetoed_seglistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglistdict</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglistdict</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>
	
	<span class="k">def</span> <span class="nf">getslide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slide_num</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the triggers with a specific slide number.</span>
<span class="sd">		@param slide_num: the slide number to recover (contained in the event_id)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">slideTrigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">slideTrigs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get_slide_number</span><span class="p">()</span> <span class="o">==</span> <span class="n">slide_num</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">slideTrigs</span>


<span class="k">class</span> <span class="nc">SnglInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">chirp_distance</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">dist</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">ref_mass</span> <span class="o">/</span> <span class="n">mchirp</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># Properties</span>
	<span class="c1">#</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin1</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin2</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="c1">#</span>
	<span class="c1"># simulate tempate_id column</span>
	<span class="c1"># FIXME:  add a proper column for this</span>
	<span class="c1">#</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">template_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gamma0</span><span class="p">)</span>

	<span class="nd">@template_id</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">template_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Gamma0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># Methods</span>
	<span class="c1">#</span>

	<span class="k">def</span> <span class="nf">get_reduced_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisq</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chisq_dof</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_chisq</span><span class="p">)</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank_chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_reduced_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_chisq</span><span class="p">)</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">()</span><span class="o">**</span><span class="mf">0.25</span>
	
	<span class="k">def</span> <span class="nf">get_bank_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_bank_chisq</span><span class="p">()</span><span class="o">**</span><span class="mf">0.25</span>

	<span class="k">def</span> <span class="nf">get_cont_effective_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mf">250.0</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span><span class="o">**</span><span class="mf">0.25</span>

	<span class="k">def</span> <span class="nf">get_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">()</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="k">if</span> <span class="n">rchisq</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span>

	<span class="k">def</span> <span class="nf">get_bank_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_bank_chisq</span><span class="p">()</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="k">if</span> <span class="n">rchisq</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span>

	<span class="k">def</span> <span class="nf">get_cont_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span>
		<span class="n">nhigh</span> <span class="o">=</span> <span class="mf">2.</span>
		<span class="k">if</span> <span class="n">rchisq</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">/</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span>

	<span class="k">def</span> <span class="nf">get_far</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>

	<span class="k">def</span> <span class="nf">get_ifar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">&lt;</span> <span class="mf">0.000000001</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.000000001</span>
		<span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>

	<span class="k">def</span> <span class="nf">get_lvS5stat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>

	<span class="c1"># FIXME: how are two inspiral events defined to be the same?</span>
	<span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ifo</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">mass1</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">mass2</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spin1</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spin2</span><span class="p">)</span> <span class="ow">or</span>
			<span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">search</span><span class="p">)</span>
		<span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># Legacy</span>
	<span class="c1">#</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>

	<span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">gps</span>


<span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;minimum_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;false_alarm_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;combined_far&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="c1"># FIXME:  like some other tables here, this table should have the</span>
	<span class="c1"># constraint that the coinc_event_id column is a primary key.  this</span>
	<span class="c1"># breaks ID reassignment in ligolw_sqlite, so until that is fixed</span>
	<span class="c1"># the constraint is being replaced with an index.</span>
	<span class="c1">#constraints = &quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ci_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifos&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = CoincInspiral()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifos == &#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.end</span>
<span class="sd">	LIGOTimeGPS(10, 0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.end)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>

	<span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifos</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">ifos</span>


<span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             sngl_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglRingdownID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sngl_ringdown&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;num_clust_trigs&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1H2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1L1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H2L1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H2V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_L1V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigma_sq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglRingdownID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifo&quot;</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">SnglRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>

	<span class="k">def</span> <span class="nf">get_id_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the three pieces of the int_8s-style event_id.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">int_event_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">int_event_id</span> <span class="o">//</span> <span class="mi">1000000000</span>
		<span class="n">slidenum</span> <span class="o">=</span> <span class="p">(</span><span class="n">int_event_id</span> <span class="o">%</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100000</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">int_event_id</span> <span class="o">%</span> <span class="mi">100000</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">slidenum</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>


<span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;choppedl_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_sq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_coh_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;null_stat&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_ratio&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;false_alarm_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;combined_far&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="c1"># constraints = &quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cr_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifos&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifos</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="n">ifos_from_instrument_set</span><span class="p">(</span><span class="n">ifos</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">)</span>


<span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             multi_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">MultiInspiralID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;multi_inspiral&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MultiInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;multi_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h1h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coa_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ttotal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;trace_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_7&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_8&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_9&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_term_10&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sngl_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sngl_bank_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_h1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sngl_cont_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_angle&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_angle_sig&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;inclination&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;null_statistic&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;null_stat_h1h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;null_stat_degen&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h1quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h1quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h2quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h2quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l1quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l1quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g1quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g1quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t1quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t1quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v1quad_re&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v1quad_im&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coh_snr_h1h2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cohSnrSqLocal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;autoCorrCohSq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;crossCorrCohSq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;autoCorrNullSq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;crossCorrNullSq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ampMetricEigenVal1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ampMetricEigenVal2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">MultiInspiralID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifos&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">)</span>
	<span class="n">instrument_id</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;G1&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;H1&quot;</span><span class="p">:</span><span class="s2">&quot;h1&quot;</span><span class="p">,</span> <span class="s2">&quot;H2&quot;</span><span class="p">:</span><span class="s2">&quot;h2&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">:</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;T1&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
	                 <span class="s2">&quot;V1&quot;</span><span class="p">:</span><span class="s2">&quot;v&quot;</span><span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;bestnr&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bestnr</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;new_snr&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_snr</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;null_snr&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_null_snr</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;coinc_snr&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coinc_snr</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_bank_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_bank_chisq</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;reduced_cont_chisq&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;reduced_chisq_h1&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="o">=</span><span class="s2">&quot;hl&quot;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;reduced_chisq_h2&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="o">=</span><span class="s2">&quot;h2&quot;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;reduced_chisq_l&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="o">=</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;reduced_chisq_v&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">get_coinc_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snrs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>\
			            <span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">get_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span><span class="n">nhigh</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;chisq&#39;</span><span class="p">):</span>
		<span class="c1"># kwarg &#39;index&#39; is assigned to the parameter chisq_index</span>
		<span class="c1"># nhigh gives the asymptotic large rho behaviour of</span>
		<span class="c1"># d (ln chisq) / d (ln rho) </span>
		<span class="c1"># for fixed new_snr eg nhigh = 2 -&gt; chisq ~ rho^2 at large rho </span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;reduced_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">column</span><span class="p">)</span>
		<span class="n">newsnr</span> <span class="o">=</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">newsnr</span><span class="p">,</span> <span class="n">rchisq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">newsnr</span>

	<span class="k">def</span> <span class="nf">get_null_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the coherent Null SNR for each row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">null_snr_sq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coinc_snr</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">null_snr_sq</span><span class="p">[</span><span class="n">null_snr_sq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
		<span class="k">return</span> <span class="n">null_snr_sq</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_coinc_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coincident chisq for each row in the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_chisqs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>\
						<span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

	<span class="k">def</span> <span class="nf">get_reduced_coinc_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coincident chisq per degree of freedom for each</span>
<span class="sd">		row in the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">dof</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sngl_chisq_dof</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coinc_chisq</span><span class="p">()</span><span class="o">/</span><span class="n">dof</span>

	<span class="k">def</span> <span class="nf">get_null_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coherent null chisq for each row in the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">null_chisq_sq</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_coinc_chisq</span><span class="p">()</span> <span class="o">-</span>
		                 <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">())</span>
		<span class="n">null_chisq_sq</span><span class="p">[</span><span class="n">null_chisq_sq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
		<span class="k">return</span> <span class="n">null_chisq_sq</span>

	<span class="k">def</span> <span class="nf">get_sigmasq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector SNR of the given instrument for each</span>
<span class="sd">		row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;sigmasq_</span><span class="si">%s</span><span class="s1">&#39;</span>
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>

	<span class="k">def</span> <span class="nf">get_sigmasqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return dictionary of single-detector sigmas for each row in the</span>
<span class="sd">		table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">instruments</span><span class="p">:</span>
				<span class="n">instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> \
					<span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ifos</span><span class="p">)))</span>
			<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sigmasq</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>\
				    <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>


	<span class="k">def</span> <span class="nf">get_sngl_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector SNR of the given instrument for each</span>
<span class="sd">		row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr_</span><span class="si">%s</span><span class="s1">&#39;</span>\
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>

	<span class="k">def</span> <span class="nf">get_sngl_snrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector SNRs for each row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> \
			                <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ifos</span><span class="p">)))</span>
		<span class="k">elif</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snr</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>\
		            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_sngl_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 of the given instrument for each</span>
<span class="sd">		row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq_</span><span class="si">%s</span><span class="s1">&#39;</span>\
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>

	<span class="k">def</span> <span class="nf">get_sngl_chisqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 for each row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> \
			                <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ifos</span><span class="p">)))</span>
		<span class="k">elif</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>\
		            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_sngl_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 of the given instrument for each</span>
<span class="sd">		row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;bank_chisq_</span><span class="si">%s</span><span class="s1">&#39;</span>\
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>

	<span class="k">def</span> <span class="nf">get_sngl_bank_chisqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 for each row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> \
			                <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ifos</span><span class="p">)))</span>
		<span class="k">elif</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_bank_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>\
		            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_sngl_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 of the given instrument for each</span>
<span class="sd">		row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;cont_chisq_</span><span class="si">%s</span><span class="s1">&#39;</span>\
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>

	<span class="k">def</span> <span class="nf">get_sngl_cont_chisqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector \chi^2 for each row in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> \
			                <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ifos</span><span class="p">)))</span>
		<span class="k">elif</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_cont_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>\
		            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_bestnr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">null_snr_threshold</span><span class="o">=</span><span class="mf">4.25</span><span class="p">,</span>\
		           <span class="n">null_grad_thresh</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span> <span class="n">null_grad_val</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">5.</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the BestNR statistic for each row in the table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_bestnr</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">nhigh</span><span class="o">=</span><span class="n">nhigh</span><span class="p">,</span>
		                       <span class="n">null_snr_threshold</span><span class="o">=</span><span class="n">null_snr_threshold</span><span class="p">,</span>
		                       <span class="n">null_grad_thresh</span><span class="o">=</span><span class="n">null_grad_thresh</span><span class="p">,</span>
		                       <span class="n">null_grad_val</span><span class="o">=</span><span class="n">null_grad_val</span><span class="p">)</span>
		        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">getstat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">veto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seglist</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">vetoed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the inverse of what veto returns, i.e., return the triggers</span>
<span class="sd">		that lie within a given seglist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>

	<span class="k">def</span> <span class="nf">getslide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slide_num</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the triggers with a specific slide number.</span>
<span class="sd">		@param slide_num: the slide number to recover (contained in the event_id)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">slideTrigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">slideTrigs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get_slide_number</span><span class="p">()</span> <span class="o">==</span> <span class="n">slide_num</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">slideTrigs</span>

	<span class="k">def</span> <span class="nf">get_reduced_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the chisq per degree of freedom for each row in</span>
<span class="sd">		this table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;chisq_dof&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the bank chisq per degree of freedom for each row in</span>
<span class="sd">		this table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;bank_chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;bank_chisq_dof&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the auto (continuous) chisq per degree of freedom</span>
<span class="sd">		for each row in this table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;cont_chisq&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;cont_chisq_dof&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_reduced_sngl_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the single-detector chisq per degree of freedom for</span>
<span class="sd">		each row in this table</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;chisq_</span><span class="si">%s</span><span class="s2">&quot;</span>
		                        <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span> <span class="o">/</span>
		        <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;sngl_chisq_dof&quot;</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_sngl_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;chisq&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
		<span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_bank_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="o">/</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_dof&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="p">)</span>
		<span class="n">snr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span>
		<span class="n">newsnr</span> <span class="o">=</span> <span class="n">snr</span><span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">newsnr</span><span class="p">,</span> <span class="n">rchisq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">newsnr</span>


<span class="k">class</span> <span class="nc">MultiInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">MultiInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
	<span class="n">instrument_id</span> <span class="o">=</span> <span class="n">MultiInspiralTable</span><span class="o">.</span><span class="n">instrument_id</span>

	<span class="k">def</span> <span class="nf">get_reduced_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_reduced_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank_chisq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank_chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_reduced_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_chisq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_reduced_sngl_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
		                <span class="s2">&quot;chisq_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span> <span class="o">/</span>
		        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sngl_chisq_dof&quot;</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_reduced_sngl_bank_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;bank_chisq_</span><span class="si">%s</span><span class="s2">&quot;</span>
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()]))</span> <span class="o">/</span>
				<span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sngl_bank_chisq_dof&quot;</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_reduced_sngl_cont_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;cont_chisq_</span><span class="si">%s</span><span class="s2">&quot;</span>
		                       <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()]))</span> <span class="o">/</span>
				<span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sngl_bank_chisq_dof&quot;</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set of the instruments for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_coinc_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the coincident SNR for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snrs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>\
		            <span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_coinc_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coincident chisq for this row</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_chisqs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
		            <span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_reduced_coinc_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coincident chisq per degree of freedom for this row</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coinc_chisq</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sngl_chisq_dof</span>

	<span class="k">def</span> <span class="nf">get_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;chisq&#39;</span><span class="p">):</span>
		<span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_bank_chisq</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_cont_chisq</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="o">/</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_dof&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">rchisq</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">/</span>\
                               <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span>

	<span class="k">def</span> <span class="nf">get_sngl_new_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;chisq&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
		<span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_bank_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span>
			<span class="n">rchisq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_sngl_cont_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">rchisq</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snr</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span> <span class="o">/</span>\
							   <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">rchisq</span><span class="o">**</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">nhigh</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">index</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span>


	<span class="k">def</span> <span class="nf">get_sngl_new_snrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;chisq&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns a dictionary of single-detector newSNRs for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span>
		             <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_new_snr</span><span class="p">(</span><span class="n">ifo</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">nhigh</span><span class="o">=</span><span class="n">nhigh</span><span class="p">))</span> <span class="k">for</span>
		            <span class="n">ifo</span> <span class="ow">in</span> <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">))</span>


	<span class="k">def</span> <span class="nf">get_null_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the coherent Null SNR for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">null_snr_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snrs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>\
                             <span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="o">**</span><span class="mi">2</span>
		<span class="k">if</span> <span class="n">null_snr_sq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">null_snr_sq</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_null_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the coherent null chisq for this row</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">null_chisq_sq</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_coinc_chisq</span><span class="p">()</span> <span class="o">-</span>
		                 <span class="bp">self</span><span class="o">.</span><span class="n">get_reduced_chisq</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">null_chisq_sq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">null_chisq_sq</span>

	<span class="k">def</span> <span class="nf">get_sngl_snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the single-detector SNR for the given instrument for this</span>
<span class="sd">		row</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;snr_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>


	<span class="k">def</span> <span class="nf">get_sngl_snrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a dictionary of single-detector SNRs for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_snr</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span>\
                            <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_sngl_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns the single-detector chisq for the given instrument</span>
<span class="sd">		for this row</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
		               <span class="s2">&quot;chisq_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>


	<span class="k">def</span> <span class="nf">get_sngl_chisqs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;@returns a dictionary of single-detector chisqs for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sngl_chisq</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span>
                            <span class="n">instrument_set_from_ifos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Serialize a sequence of instruments into the ifos</span>
<span class="sd">		attribute.  The instrument names must not contain the &quot;,&quot;</span>
<span class="sd">		character.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="n">ifos_from_instrument_set</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_id_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the three pieces of the int_8s-style event_id.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">int_event_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">int_event_id</span> <span class="o">//</span> <span class="mi">1000000000</span>
		<span class="n">slidenum</span> <span class="o">=</span> <span class="p">(</span><span class="n">int_event_id</span> <span class="o">%</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100000</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">int_event_id</span> <span class="o">%</span> <span class="mi">100000</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">slidenum</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_slide_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the slide-number for this trigger</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">a</span><span class="p">,</span> <span class="n">slide_number</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_parts</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">slide_number</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
			<span class="n">slide_number</span> <span class="o">=</span> <span class="mi">5000</span> <span class="o">-</span> <span class="n">slide_number</span>
		<span class="k">return</span> <span class="n">slide_number</span>

	<span class="k">def</span> <span class="nf">get_bestnr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">nhigh</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">null_snr_threshold</span><span class="o">=</span><span class="mf">4.25</span><span class="p">,</span>\
		           <span class="n">null_grad_thresh</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span> <span class="n">null_grad_val</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">5.</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the BestNR statistic for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># weight SNR by chisq</span>
		<span class="n">bestnr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_snr</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">nhigh</span><span class="o">=</span><span class="n">nhigh</span><span class="p">,</span>
		                          <span class="n">column</span><span class="o">=</span><span class="s2">&quot;chisq&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ifos</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">bestnr</span>
		<span class="c1"># recontour null SNR threshold for higher SNRs</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">&gt;</span> <span class="n">null_grad_thresh</span><span class="p">:</span>
			<span class="n">null_snr_threshold</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">-</span> <span class="n">null_grad_thresh</span><span class="p">)</span> <span class="o">*</span> <span class="n">null_grad_val</span>
		<span class="c1"># weight SNR by null SNR</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_null_snr</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">null_snr_threshold</span><span class="p">:</span>
			<span class="n">bestnr</span> <span class="o">/=</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_null_snr</span><span class="p">()</span> <span class="o">-</span> <span class="n">null_snr_threshold</span>
		<span class="k">return</span> <span class="n">bestnr</span>


<span class="n">MultiInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">MultiInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              sim_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimInspiralID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sim_inspiral&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;inclination&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coa_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;theta0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_lower&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_final&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_mode_min&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_mode_max&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_data&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_order&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;taper&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandpass&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimInspiralID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;chirp_dist&#39;</span> <span class="ow">or</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;chirp_distance&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chirp_dist</span><span class="p">()</span>
		<span class="c1"># be strict about formatting of chirp eff distance</span>
		<span class="k">if</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;chirp_eff_dist&#39;</span> <span class="ow">and</span> <span class="n">column</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_h&#39;</span><span class="p">,</span><span class="s1">&#39;_l&#39;</span><span class="p">,</span><span class="s1">&#39;_g&#39;</span><span class="p">,</span><span class="s1">&#39;_t&#39;</span><span class="p">,</span><span class="s1">&#39;_v&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
			<span class="n">site</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chirp_eff_dist</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;spin1&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spin_mag</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;spin2&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spin_mag</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;total_mass&#39;</span> <span class="ow">or</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;mtotal&#39;</span><span class="p">:</span>
			<span class="n">m1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s1">&#39;mass1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
			<span class="n">m2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s1">&#39;mass2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">m1</span><span class="o">+</span><span class="n">m2</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">get_chirp_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ref_mass</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
		<span class="n">mchirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;mchirp&#39;</span><span class="p">)</span>
		<span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">SnglInspiral</span><span class="o">.</span><span class="n">chirp_distance</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_chirp_eff_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">ref_mass</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
		<span class="n">mchirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;mchirp&#39;</span><span class="p">)</span>
		<span class="n">eff_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;eff_dist_&#39;</span> <span class="o">+</span> <span class="n">site</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">SnglInspiral</span><span class="o">.</span><span class="n">chirp_distance</span><span class="p">(</span><span class="n">eff_dist</span><span class="p">,</span> <span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_spin_mag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">objectnumber</span><span class="p">):</span>
		<span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;spin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">objectnumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
		<span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;spin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">objectnumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
		<span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;spin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">objectnumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">sx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">veto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seglist</span><span class="p">,</span><span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">(</span><span class="n">site</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">veto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seglist</span><span class="p">):</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">keep</span>

	<span class="k">def</span> <span class="nf">vetoed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the inverse of what veto returns, i.e., return the triggers</span>
<span class="sd">		that lie within a given seglist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">vetoed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
				<span class="n">vetoed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vetoed</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">get_end</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">SimInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SimInspiral()</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = 0., 0.</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec</span>
<span class="sd">	(0.0, 0.0)</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.ra_dec)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.end_time_gmst)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = LIGOTimeGPS(6e8)</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	600000000</span>
<span class="sd">	&gt;&gt;&gt; print(numpy.around(x.end_time_gmst, 8))</span>
<span class="sd">	-2238.39417156</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;geocent_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;geocent_end_time_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span>

	<span class="nd">@ra_dec</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">radec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">radec</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin1</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin2</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="k">def</span> <span class="nf">time_at_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offsetvect</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the &quot;time&quot; of the injection, delay corrected for the</span>
<span class="sd">		displacement from the geocentre to the given instrument.</span>

<span class="sd">		NOTE:  this method does not account for the rotation of the</span>
<span class="sd">		Earth that occurs during the transit of the plane wave from</span>
<span class="sd">		the detector to the geocentre.  That is, it is assumed the</span>
<span class="sd">		Earth is in the same orientation with respect to the</span>
<span class="sd">		celestial sphere when the wave passes through the detector</span>
<span class="sd">		as when it passes through the geocentre.  The Earth rotates</span>
<span class="sd">		by about 1.5 urad during the 21 ms it takes light to travel</span>
<span class="sd">		the radius of the Earth, which corresponds to 10 m of</span>
<span class="sd">		displacement at the equator, or 33 light-ns.  Therefore,</span>
<span class="sd">		the failure to do a proper retarded time calculation here</span>
<span class="sd">		results in errors as large as 33 ns.  This is insignificant</span>
<span class="sd">		for burst searches, but be aware that this approximation is</span>
<span class="sd">		being made if the return value is used in other contexts.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># the offset is subtracted from the time of the injection.</span>
		<span class="c1"># injections are done this way so that when the triggers</span>
		<span class="c1"># that result from an injection have the offset vector</span>
		<span class="c1"># added to their times the triggers will form a coinc</span>
		<span class="n">t_geocent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">-</span> <span class="n">offsetvect</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
		<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>
		<span class="k">return</span> <span class="n">t_geocent</span> <span class="o">+</span> <span class="n">lal</span><span class="o">.</span><span class="n">TimeDelayFromEarthCenter</span><span class="p">(</span><span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">t_geocent</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_time_geocent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># FIXME:  delete this method</span>
		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SimInspiral.get_time_geocent() is deprecated.  use SimInspiral.time_geocent instead&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span>

	<span class="k">def</span> <span class="nf">set_time_geocent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="c1"># FIXME:  delete this method</span>
		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SimInspiral.set_time_geocent() is deprecated.  use SimInspiral.time_geocent instead&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># FIXME:  delete this method</span>
		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SimInspiral.get_ra_dec() is deprecated.  use SimInspiral.ra_dec instead&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="c1"># FIXME:  delete this method</span>
		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SimInspiral.get_end() is deprecated.  use SimInspiral.time_geocent or SimInspiral.time_at_instrument() instead&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_end_time&quot;</span> <span class="o">%</span> <span class="n">site</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_end_time_ns&quot;</span> <span class="o">%</span> <span class="n">site</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

	<span class="k">def</span> <span class="nf">get_eff_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;eff_dist_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instrument</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_chirp_eff_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">ref_mass</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">SnglInspiral</span><span class="o">.</span><span class="n">chirp_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_eff_dist</span><span class="p">(</span><span class="n">instrument</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_spin_mag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectnumber</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;spin</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">objectnumber</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>


<span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               sim_burst:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimBurstID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sim_burst&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimBurstTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_burst&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gps&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gps_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;pol_ellipse_angle&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;pol_ellipse_e&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;egw_over_rsquared&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform_number&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimBurstID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;waveform&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimBurst</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SimBurst()</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = 0., 0.</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec</span>
<span class="sd">	(0.0, 0.0)</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.ra_dec)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent_gmst)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = LIGOTimeGPS(6e8)</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	600000000</span>
<span class="sd">	&gt;&gt;&gt; print(numpy.around(x.time_geocent_gmst, 8))</span>
<span class="sd">	-2238.39417156</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SimBurstTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;time_geocent_gps&quot;</span><span class="p">,</span> <span class="s2">&quot;time_geocent_gps_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;time_geocent_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span>

	<span class="nd">@ra_dec</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">radec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">radec</span>

	<span class="k">def</span> <span class="nf">time_at_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offsetvect</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the &quot;time&quot; of the injection, delay corrected for the</span>
<span class="sd">		displacement from the geocentre to the given instrument.</span>

<span class="sd">		NOTE:  this method does not account for the rotation of the</span>
<span class="sd">		Earth that occurs during the transit of the plane wave from</span>
<span class="sd">		the detector to the geocentre.  That is, it is assumed the</span>
<span class="sd">		Earth is in the same orientation with respect to the</span>
<span class="sd">		celestial sphere when the wave passes through the detector</span>
<span class="sd">		as when it passes through the geocentre.  The Earth rotates</span>
<span class="sd">		by about 1.5 urad during the 21 ms it takes light to travel</span>
<span class="sd">		the radius of the Earth, which corresponds to 10 m of</span>
<span class="sd">		displacement at the equator, or 33 light-ns.  Therefore,</span>
<span class="sd">		the failure to do a proper retarded time calculation here</span>
<span class="sd">		results in errors as large as 33 ns.  This is insignificant</span>
<span class="sd">		for burst searches, but be aware that this approximation is</span>
<span class="sd">		being made if the return value is used in other contexts.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># the offset is subtracted from the time of the injection.</span>
		<span class="c1"># injections are done this way so that when the triggers</span>
		<span class="c1"># that result from an injection have the offset vector</span>
		<span class="c1"># added to their times the triggers will form a coinc</span>
		<span class="n">t_geocent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">-</span> <span class="n">offsetvect</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
		<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>
		<span class="k">return</span> <span class="n">t_geocent</span> <span class="o">+</span> <span class="n">lal</span><span class="o">.</span><span class="n">TimeDelayFromEarthCenter</span><span class="p">(</span><span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">t_geocent</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_time_geocent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span>

	<span class="k">def</span> <span class="nf">set_time_geocent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gps</span>

	<span class="k">def</span> <span class="nf">get_ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Do not use this method:  use .time_at_instrument() if that&#39;s what you want, or use .time_geocent if that&#39;s what you want.</span>

<span class="sd">		Also ... this doesn&#39;t return the *end time*, it returns the *PEAK TIME*.  You&#39;ve been warned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span>
		<span class="n">instrument</span> <span class="o">=</span> <span class="n">site</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span>	<span class="c1"># ugh ...</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_at_instrument</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="p">{</span><span class="n">instrument</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>

<span class="n">SimBurstTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimBurst</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              sim_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimRingdownID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sim_ringdown&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;inclination&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimRingdownID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">site</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geocent_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geocent_start_time_ns</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">site</span> <span class="o">=</span> <span class="n">site</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span> <span class="o">+</span> <span class="s1">&#39;_start_time&#39;</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span> <span class="o">+</span> <span class="s1">&#39;_start_time_ns&#39;</span><span class="p">))</span>


<span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               summ_value:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SummValueID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;summ_value&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;summ_value_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummValueTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;summ_value&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;summ_value_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frameset_group&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;intvalue&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (summ_value_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SummValueID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ifo&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummValue</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SummValue()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifo == &#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == {&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">	&gt;&gt;&gt; x.start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.segment)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SummValueTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifo&quot;</span><span class="p">)</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>


<span class="n">SummValueTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SummValue</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            sim_inst_params:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimInstParamsID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;sim_inst_params&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimInstParamsTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_inst_params&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimInstParamsID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimInstParams</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SimInstParamsTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">SimInstParamsTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimInstParams</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               stochastic:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">StochasticTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;stochastic&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo_one&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo_two&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel_one&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel_two&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_min&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_max&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cc_stat&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cc_sigma&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">Stochastic</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">StochasticTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">StochasticTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Stochastic</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               stochsumm:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">StochSummTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;stochsumm&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo_one&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo_two&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel_one&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel_two&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_min&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_max&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;y_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">StochSumm</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">StochSummTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">StochSummTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">StochSumm</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            external_trigger:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1"># FIXME: this table is completely different from the official definition.</span>
<span class="c1"># Someone *HAS* to sort this out.</span>


<span class="k">class</span> <span class="nc">ExtTriggersTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;external_trigger&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_alts&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_band&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_fluence&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_fluence_int&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_peak&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_peak_int&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;det_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;email_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_dec_err&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_epoch&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_err_type&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_ra_err&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_z_err&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_comments&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_id&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_sequence&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_type&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;notice_url&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_fov_dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_fov_dec_width&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_fov_ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_fov_ra_width&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_loc_ele&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_loc_lat&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;obs_loc_long&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_fave_lho&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_fave_llo&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ligo_delay&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_number_gcn&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_number_grb&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_status&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">ExtTriggers</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExtTriggersTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">ExtTriggersTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">ExtTriggers</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                 filter:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">FilterID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;filter_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FilterTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;filter&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_set&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (filter_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">FilterID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">FilterTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">FilterTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Filter</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                segment:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_cdb&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,)</span>


<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">Segment</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Segment()</span>
<span class="sd">	&gt;&gt;&gt; x.start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.segment)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.start)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; # non-LIGOTimeGPS times are converted to LIGOTimeGPS</span>
<span class="sd">	&gt;&gt;&gt; x.segment = (20, 30.125)</span>
<span class="sd">	&gt;&gt;&gt; x.end</span>
<span class="sd">	LIGOTimeGPS(30, 125000000)</span>
<span class="sd">	&gt;&gt;&gt; # initialization from a tuple or with arguments</span>
<span class="sd">	&gt;&gt;&gt; Segment((20, 30)).segment</span>
<span class="sd">	segment(LIGOTimeGPS(20, 0), LIGOTimeGPS(30, 0))</span>
<span class="sd">	&gt;&gt;&gt; Segment(20, 30).segment</span>
<span class="sd">	segment(LIGOTimeGPS(20, 0), LIGOTimeGPS(30, 0))</span>
<span class="sd">	&gt;&gt;&gt; # use as a segment object in segmentlist operations</span>
<span class="sd">	&gt;&gt;&gt; from ligo import segments</span>
<span class="sd">	&gt;&gt;&gt; x = segments.segmentlist([Segment(0, 10), Segment(20, 30)])</span>
<span class="sd">	&gt;&gt;&gt; abs(x)</span>
<span class="sd">	LIGOTimeGPS(20, 0)</span>
<span class="sd">	&gt;&gt;&gt; y = segments.segmentlist([Segment(5, 15), Segment(25, 35)])</span>
<span class="sd">	&gt;&gt;&gt; abs(x &amp; y)</span>
<span class="sd">	LIGOTimeGPS(10, 0)</span>
<span class="sd">	&gt;&gt;&gt; abs(x | y)</span>
<span class="sd">	LIGOTimeGPS(30, 0)</span>
<span class="sd">	&gt;&gt;&gt; 8.0 in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; 12 in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; Segment(2, 3) in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; Segment(2, 12) in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; segments.segment(2, 3) in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; segments.segment(2, 12) in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; # make sure results are segment table row objects</span>
<span class="sd">	&gt;&gt;&gt; segments.segmentlist(map(Segment, x &amp; y))	# doctest: +ELLIPSIS</span>
<span class="sd">	[&lt;glue.ligolw.lsctables.Segment object at 0x...&gt;, &lt;glue.ligolw.lsctables.Segment object at 0x...&gt;]</span>

<span class="sd">	This implementation uses a non-standard extension to encode</span>
<span class="sd">	infinite values for boundaries:  the second and nanosecond</span>
<span class="sd">	components are both set to 0x7FFFFFFF or 0xFFFFFFFF to indicate</span>
<span class="sd">	positive resp. negative infinity.  For this reason, &quot;denormalized&quot;</span>
<span class="sd">	LIGOTimeGPS objects (objects whose nanoseconds fields contain</span>
<span class="sd">	values exceeding +/-999999999) are disallowed for use with this</span>
<span class="sd">	class.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Segment()</span>
<span class="sd">	&gt;&gt;&gt; # OK</span>
<span class="sd">	&gt;&gt;&gt; x.start = -segments.infinity()</span>
<span class="sd">	&gt;&gt;&gt; # also OK</span>
<span class="sd">	&gt;&gt;&gt; x.start = float(&quot;-inf&quot;)</span>
<span class="sd">	&gt;&gt;&gt; # infinite boundaries always returned as segments.infinity</span>
<span class="sd">	&gt;&gt;&gt; # instances</span>
<span class="sd">	&gt;&gt;&gt; x.start</span>
<span class="sd">	-infinity</span>
<span class="sd">	&gt;&gt;&gt; x.end = float(&quot;+inf&quot;)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(-infinity, infinity)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SegmentTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the segment described by this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span>

	<span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the segment described by this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">segment</span>

	<span class="c1"># emulate a ligo.segments.segment object</span>

	<span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">&lt;</span> <span class="n">other</span>

	<span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">==</span> <span class="n">other</span>

	<span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span>

	<span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="nb">super</span><span class="p">(</span><span class="n">Segment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">args</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1"># first try unpacking arguments</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">args</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="c1"># didn&#39;t work, try unpacking 0th argument</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>

	<span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>


<span class="n">SegmentTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Segment</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            segment_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentDefID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment_definer&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;segment_def_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;insertion_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_def_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentDefID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">SegmentDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SegmentDef()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifos == &#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments =={&#39;H1&#39;, &#39;L1&#39;}</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set of the instruments for this row.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span>

	<span class="k">def</span> <span class="nf">set_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Serialize a sequence of instruments into the ifos</span>
<span class="sd">		attribute.  The instrument names must not contain the &quot;,&quot;</span>
<span class="sd">		character.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">instruments</span>


<span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SegmentDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            segment_summary:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentSumID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment_summary&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;segment_sum_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentSumTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment_summary&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_sum_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_cdb&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_sum_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentSumID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span><span class="s2">&quot;segment_def_id&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_def_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlist object describing the times spanned by</span>
<span class="sd">		the segments carrying the given segment_def_id.  If</span>
<span class="sd">		segment_def_id is None then all segments are returned.</span>

<span class="sd">		Note:  the result is not coalesced, the segmentlist</span>
<span class="sd">		contains the segments as they appear in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">segment_def_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">segment_def_id</span> <span class="o">==</span> <span class="n">segment_def_id</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentSum</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SegmentSum</span>



<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               time_slide:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">TimeSlideID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;time_slide&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;time_slide_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeSlideTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;time_slide&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instrument&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (time_slide_id, instrument)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">TimeSlideID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;time_slide_id&quot;</span><span class="p">,</span> <span class="s2">&quot;instrument&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a ditionary mapping time slide IDs to offset</span>
<span class="sd">		dictionaries.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># FIXME:  deferred to work around non-LDG environments</span>
		<span class="kn">from</span> <span class="nn">lalburst.offsetvector</span> <span class="kn">import</span> <span class="n">offsetvector</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsetvector</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">instrument</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;: duplicate instrument &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">instrument</span><span class="p">))</span>
			<span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">][</span><span class="n">row</span><span class="o">.</span><span class="n">instrument</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">offset</span>
		<span class="k">return</span> <span class="n">d</span>

	<span class="k">def</span> <span class="nf">append_offsetvector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offsetvect</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Append rows describing an instrument --&gt; offset mapping to</span>
<span class="sd">		this table.  offsetvect is a dictionary mapping instrument</span>
<span class="sd">		to offset.  process should be the row in the process table</span>
<span class="sd">		on which the new time_slide table rows will be blamed (or</span>
<span class="sd">		any object with a process_id attribute).  The return value</span>
<span class="sd">		is the time_slide_id assigned to the new rows.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">time_slide_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsetvect</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">()</span>
			<span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">process_id</span>
			<span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span> <span class="o">=</span> <span class="n">time_slide_id</span>
			<span class="n">row</span><span class="o">.</span><span class="n">instrument</span> <span class="o">=</span> <span class="n">instrument</span>
			<span class="n">row</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">time_slide_id</span>

	<span class="k">def</span> <span class="nf">get_time_slide_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offsetvect</span><span class="p">,</span> <span class="n">create_new</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">superset_ok</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nonunique_ok</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the time_slide_id corresponding to the offset vector</span>
<span class="sd">		described by offsetvect, a dictionary of instrument/offset</span>
<span class="sd">		pairs.</span>

<span class="sd">		If the optional create_new argument is None (the default),</span>
<span class="sd">		then the table must contain a matching offset vector.  The</span>
<span class="sd">		return value is the ID of that vector.  If the table does</span>
<span class="sd">		not contain a matching offset vector then KeyError is</span>
<span class="sd">		raised.</span>

<span class="sd">		If the optional create_new argument is set to a Process</span>
<span class="sd">		object (or any other object with a process_id attribute),</span>
<span class="sd">		then if the table does not contain a matching offset vector</span>
<span class="sd">		a new one will be added to the table and marked as having</span>
<span class="sd">		been created by the given process.  The return value is the</span>
<span class="sd">		ID of the (possibly newly created) matching offset vector.</span>

<span class="sd">		If the optional superset_ok argument is False (the default)</span>
<span class="sd">		then an offset vector in the table is considered to &quot;match&quot;</span>
<span class="sd">		the requested offset vector only if they contain the exact</span>
<span class="sd">		same set of instruments.  If the superset_ok argument is</span>
<span class="sd">		True, then an offset vector in the table is considered to</span>
<span class="sd">		match the requested offset vector as long as it provides</span>
<span class="sd">		the same offsets for the same instruments as the requested</span>
<span class="sd">		vector, even if it provides offsets for other instruments</span>
<span class="sd">		as well.</span>

<span class="sd">		More than one offset vector in the table might match the</span>
<span class="sd">		requested vector.  If the optional nonunique_ok argument is</span>
<span class="sd">		False (the default), then KeyError will be raised if more</span>
<span class="sd">		than one offset vector in the table is found to match the</span>
<span class="sd">		requested vector.  If the optional nonunique_ok is True</span>
<span class="sd">		then the return value is the ID of one of the matching</span>
<span class="sd">		offset vectors selected at random.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># look for matching offset vectors</span>
		<span class="k">if</span> <span class="n">superset_ok</span><span class="p">:</span>
			<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">offsetvect</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">((</span><span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">slide</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">offsetvect</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">offsetvect</span> <span class="o">==</span> <span class="n">slide</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># found more than one</span>
			<span class="k">if</span> <span class="n">nonunique_ok</span><span class="p">:</span>
				<span class="c1"># and that&#39;s OK</span>
				<span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="c1"># and that&#39;s not OK</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not unique&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">offsetvect</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># found one</span>
			<span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="c1"># offset vector not found in table</span>
		<span class="k">if</span> <span class="n">create_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># and that&#39;s not OK</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">offsetvect</span><span class="p">))</span>
		<span class="c1"># that&#39;s OK, create new vector, return its ID</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_offsetvector</span><span class="p">(</span><span class="n">offsetvect</span><span class="p">,</span> <span class="n">create_new</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeSlide</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">TimeSlide</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">CoincDefID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;coinc_definer&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;coinc_def_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search_coinc_type&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (coinc_def_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">CoincDefID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cd_ssct_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;search_coinc_type&quot;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_coinc_def_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">,</span> <span class="n">create_new</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the coinc_def_id for the row in the table whose</span>
<span class="sd">		search string and search_coinc_type integer have the values</span>
<span class="sd">		given.  If a matching row is not found, the default</span>
<span class="sd">		behaviour is to create a new row and return the ID assigned</span>
<span class="sd">		to the new row.  If, instead, create_new is False then</span>
<span class="sd">		KeyError is raised when a matching row is not found.  The</span>
<span class="sd">		optional description parameter can be used to set the</span>
<span class="sd">		description string assigned to the new row if one is</span>
<span class="sd">		created, otherwise the new row is left with no description.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># look for the ID</span>
		<span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">search_coinc_type</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">)]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;(search, search coincidence type) = (&#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="si">%d</span><span class="s2">) is not unique&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coinc_def_id</span>

		<span class="c1"># coinc type not found in table</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">create_new</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">((</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">))</span>
		<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">coinc_def_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="n">row</span><span class="o">.</span><span class="n">search</span> <span class="o">=</span> <span class="n">search</span>
		<span class="n">row</span><span class="o">.</span><span class="n">search_coinc_type</span> <span class="o">=</span> <span class="n">search_coinc_type</span>
		<span class="n">row</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

		<span class="c1"># return new ID</span>
		<span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">coinc_def_id</span>


<span class="k">class</span> <span class="nc">CoincDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">CoincDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">CoincDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              coinc_event:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">CoincID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;coinc_event&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_event&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instruments&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nevents&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;likelihood&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">CoincID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;coinc_def_id&quot;</span><span class="p">,</span> <span class="s2">&quot;time_slide_id&quot;</span><span class="p">,</span> <span class="s2">&quot;instruments&quot;</span><span class="p">)</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ce_cdi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_def_id&quot;</span><span class="p">,),</span>
		<span class="s2">&quot;ce_tsi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;time_slide_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">Coinc</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">CoincTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="n">insts</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;instruments&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_instruments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">insts</span>

	<span class="k">def</span> <span class="nf">set_instruments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">insts</span> <span class="o">=</span> <span class="n">instruments</span>


<span class="n">CoincTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Coinc</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            coinc_event_map:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincMapTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_event_map&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;char_v&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;table_name&quot;</span><span class="p">,)</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cem_tn_ei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;table_name&quot;</span><span class="p">,</span> <span class="s2">&quot;event_id&quot;</span><span class="p">),</span>
		<span class="s2">&quot;cem_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">CoincMap</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">CoincMapTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">CoincMapTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincMap</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                dq_list Table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">DQSpecListID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;dq_list&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;dq_list_id&quot;</span><span class="p">)</span>
<span class="n">DQSpecListRowID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;dq_list&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;dq_list_row_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DQSpecListTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;dq_list&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;dq_list_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;dq_list_row_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instrument&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;flag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;low_window&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;high_window&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (dq_list_id, dq_list_row_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">DQSpecListID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DQSpec</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">apply_to_segmentlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Apply our low and high windows to the segments in a</span>
<span class="sd">		segmentlist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seglist</span><span class="p">):</span>
			<span class="n">seglist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_window</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_window</span><span class="p">)</span>


<span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">DQSpec</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               ligolw_mon:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">LIGOLWMonID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;ligolw_mon&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LIGOLWMonTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;ligolw_mon&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;insertion_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">LIGOLWMonID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LIGOLWMon</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LIGOLWMonTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>


<span class="n">LIGOLWMonTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">LIGOLWMon</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            veto_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">VetoDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;veto_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_pad&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_pad&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">interncolumns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span><span class="s2">&quot;ifo&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">VetoDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">VetoDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">VetoDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">VetoDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               summ_mime:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SummMimeID</span> <span class="o">=</span> <span class="n">ilwd</span><span class="o">.</span><span class="n">get_ilwdchar_class</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;summ_mime&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;summ_mime_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummMimeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;summ_mime&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;submitter&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frameset_group&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;descrip&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mimedata&quot;</span><span class="p">:</span> <span class="s2">&quot;blob&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mimedata_length&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mimetype&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;summ_mime_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (summ_mime_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SummMimeID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummMime</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SummMimeTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>

	<span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time_ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time_ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">gps</span><span class="o">.</span><span class="n">nanoseconds</span>


<span class="n">SummMimeTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SummMime</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            time_slide_segment_map:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">TimeSlideSegmentMapTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;time_slide_segment_map&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ilwd:char&quot;</span><span class="p">,</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">TimeSlideSegmentMap</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">TimeSlideSegmentMapTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="n">TimeSlideSegmentMapTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">TimeSlideSegmentMap</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                Table Metadata</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># Table name ---&gt; table type mapping.</span>
<span class="c1">#</span>


<span class="n">TableByName</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">CoincDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincDefTable</span><span class="p">,</span>
	<span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincInspiralTable</span><span class="p">,</span>
	<span class="n">CoincMapTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincMapTable</span><span class="p">,</span>
	<span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincRingdownTable</span><span class="p">,</span>
	<span class="n">CoincTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincTable</span><span class="p">,</span>
	<span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">DQSpecListTable</span><span class="p">,</span>
	<span class="n">ExperimentMapTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ExperimentMapTable</span><span class="p">,</span>
	<span class="n">ExperimentSummaryTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ExperimentSummaryTable</span><span class="p">,</span>
	<span class="n">ExperimentTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ExperimentTable</span><span class="p">,</span>
	<span class="n">ExtTriggersTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ExtTriggersTable</span><span class="p">,</span>
	<span class="n">FilterTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">FilterTable</span><span class="p">,</span>
	<span class="n">GDSTriggerTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">GDSTriggerTable</span><span class="p">,</span>
	<span class="n">LfnTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">LfnTable</span><span class="p">,</span>
	<span class="n">LIGOLWMonTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">LIGOLWMonTable</span><span class="p">,</span>
	<span class="n">MultiBurstTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">MultiBurstTable</span><span class="p">,</span>
	<span class="n">MultiInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">MultiInspiralTable</span><span class="p">,</span>
	<span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ProcessParamsTable</span><span class="p">,</span>
	<span class="n">ProcessTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ProcessTable</span><span class="p">,</span>
	<span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SearchSummaryTable</span><span class="p">,</span>
	<span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SearchSummVarsTable</span><span class="p">,</span>
	<span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentDefTable</span><span class="p">,</span>
	<span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentSumTable</span><span class="p">,</span>
	<span class="n">SegmentTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentTable</span><span class="p">,</span>
	<span class="n">SimBurstTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimBurstTable</span><span class="p">,</span>
	<span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimInspiralTable</span><span class="p">,</span>
	<span class="n">SimInstParamsTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimInstParamsTable</span><span class="p">,</span>
	<span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimRingdownTable</span><span class="p">,</span>
	<span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglBurstTable</span><span class="p">,</span>
	<span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglInspiralTable</span><span class="p">,</span>
	<span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglRingdownTable</span><span class="p">,</span>
	<span class="n">StochasticTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">StochasticTable</span><span class="p">,</span>
	<span class="n">StochSummTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">StochSummTable</span><span class="p">,</span>
	<span class="n">SummValueTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SummValueTable</span><span class="p">,</span>
	<span class="n">SummMimeTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SummMimeTable</span><span class="p">,</span>
	<span class="n">TimeSlideSegmentMapTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">TimeSlideSegmentMapTable</span><span class="p">,</span>
	<span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">TimeSlideTable</span><span class="p">,</span>
	<span class="n">VetoDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">VetoDefTable</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">reset_next_ids</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	For each class in the list, if the .next_id attribute is not None</span>
<span class="sd">	(meaning the table has an ID generator associated with it), set</span>
<span class="sd">	.next_id to 0.  This has the effect of reseting the ID generators,</span>
<span class="sd">	and is useful in applications that process multiple documents and</span>
<span class="sd">	add new rows to tables in those documents.  Calling this function</span>
<span class="sd">	between documents prevents new row IDs from growing continuously</span>
<span class="sd">	from document to document.  There is no need to do this, it&#39;s</span>
<span class="sd">	purpose is merely aesthetic, but it can be confusing to open a</span>
<span class="sd">	document and find process ID 300 in the process table and wonder</span>
<span class="sd">	what happened to the other 299 processes.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; reset_next_ids(TableByName.values())</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">reset_next_id</span><span class="p">()</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               Content Handler</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># Override portions of a ligolw.LIGOLWContentHandler class</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">use_in</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Modify ContentHandler, a sub-class of</span>
<span class="sd">	glue.ligolw.LIGOLWContentHandler, to cause it to use the Table</span>
<span class="sd">	classes defined in this module when parsing XML documents.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; from glue.ligolw import ligolw</span>
<span class="sd">	&gt;&gt;&gt; class MyContentHandler(ligolw.LIGOLWContentHandler):</span>
<span class="sd">	...	pass</span>
<span class="sd">	...</span>
<span class="sd">	&gt;&gt;&gt; use_in(MyContentHandler)</span>
<span class="sd">	&lt;class &#39;glue.ligolw.lsctables.MyContentHandler&#39;&gt;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">ContentHandler</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">use_in</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">startTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">__orig_startTable</span> <span class="o">=</span> <span class="n">ContentHandler</span><span class="o">.</span><span class="n">startTable</span><span class="p">):</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">TableName</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">TableByName</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">TableByName</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="n">attrs</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">__orig_startTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

	<span class="n">ContentHandler</span><span class="o">.</span><span class="n">startTable</span> <span class="o">=</span> <span class="n">startTable</span>

	<span class="k">return</span> <span class="n">ContentHandler</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, 2016, 2017, Alexander Nitz, Ian Harry, Christopher M. Biwer, Duncan A.  Brown, Josh Willis, and Tito Dal Canton.
      <span class="lastupdated">Last updated on Oct 20, 2021.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>